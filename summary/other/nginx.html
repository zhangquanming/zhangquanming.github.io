<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>特点 | 全明笔记</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="张全明的个人笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.484694f3.css" as="style"><link rel="preload" href="/assets/js/app.07d4e7d8.js" as="script"><link rel="preload" href="/assets/js/2.e756895e.js" as="script"><link rel="preload" href="/assets/js/34.021e8dad.js" as="script"><link rel="prefetch" href="/assets/js/10.9dcd3981.js"><link rel="prefetch" href="/assets/js/11.7c3a4891.js"><link rel="prefetch" href="/assets/js/12.9123d821.js"><link rel="prefetch" href="/assets/js/13.dc2b3bbc.js"><link rel="prefetch" href="/assets/js/14.8e9572dd.js"><link rel="prefetch" href="/assets/js/15.0831d9fb.js"><link rel="prefetch" href="/assets/js/16.fff0091e.js"><link rel="prefetch" href="/assets/js/17.13d701e1.js"><link rel="prefetch" href="/assets/js/18.c01d73d7.js"><link rel="prefetch" href="/assets/js/19.6d8da221.js"><link rel="prefetch" href="/assets/js/20.7e3bfbe7.js"><link rel="prefetch" href="/assets/js/21.d67b0029.js"><link rel="prefetch" href="/assets/js/22.a1d1221b.js"><link rel="prefetch" href="/assets/js/23.97f7c972.js"><link rel="prefetch" href="/assets/js/24.f25bbb61.js"><link rel="prefetch" href="/assets/js/25.886c2813.js"><link rel="prefetch" href="/assets/js/26.d354a60e.js"><link rel="prefetch" href="/assets/js/27.8165f251.js"><link rel="prefetch" href="/assets/js/28.38db902f.js"><link rel="prefetch" href="/assets/js/29.d089321c.js"><link rel="prefetch" href="/assets/js/3.c090ecd3.js"><link rel="prefetch" href="/assets/js/30.7f597fdf.js"><link rel="prefetch" href="/assets/js/31.00125d26.js"><link rel="prefetch" href="/assets/js/32.1b584e55.js"><link rel="prefetch" href="/assets/js/33.b6331f3f.js"><link rel="prefetch" href="/assets/js/35.2b1e189b.js"><link rel="prefetch" href="/assets/js/36.4643cf1b.js"><link rel="prefetch" href="/assets/js/37.ff936690.js"><link rel="prefetch" href="/assets/js/4.55092137.js"><link rel="prefetch" href="/assets/js/5.02018b5a.js"><link rel="prefetch" href="/assets/js/6.bd7b0c2a.js"><link rel="prefetch" href="/assets/js/7.711e75c5.js"><link rel="prefetch" href="/assets/js/8.35b709e8.js"><link rel="prefetch" href="/assets/js/9.029996af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.484694f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">全明笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/summary/" class="nav-link router-link-active">
  知识总结
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  工具类
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  学习资料
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="https://www.mingme.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zhangquanming/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/summary/" class="nav-link router-link-active">
  知识总结
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  工具类
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  学习资料
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="https://www.mingme.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zhangquanming/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>知识总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/" aria-current="page" class="sidebar-link">前言</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/css/base.html" class="sidebar-link">CSS基础知识</a></li><li><a href="/summary/css/layout.html" class="sidebar-link">常见布局方式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript 相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/javascript/" class="sidebar-link">JavaScript基础知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器与网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/http/web.html" class="sidebar-link">浏览器</a></li><li><a href="/summary/http/service.html" class="sidebar-link">服务端与网络</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/framework/vue.html" class="sidebar-link">Vue</a></li><li><a href="/summary/framework/react.html" class="sidebar-link">React</a></li><li><a href="/summary/framework/Hybrid.html" class="sidebar-link">Hybrid</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>构建工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/bundler/webpack.html" class="sidebar-link">Webpack</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/monitor/monitor.html" class="sidebar-link">前端监控</a></li><li><a href="/summary/performance/performance.html" class="sidebar-link">项目性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>全栈基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/other/node.html" class="sidebar-link">Node</a></li><li><a href="/summary/other/nginx.html" aria-current="page" class="active sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#架构模型" class="sidebar-link">架构模型</a></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#常用场景" class="sidebar-link">常用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#代理" class="sidebar-link">代理</a></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#正向代理" class="sidebar-link">正向代理</a></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#反向代理" class="sidebar-link">反向代理</a></li></ul></li><li class="sidebar-sub-header"><a href="/summary/other/nginx.html#nginx-对于前端的作用" class="sidebar-link">Nginx 对于前端的作用</a></li></ul></li><li><a href="/summary/other/docker.html" class="sidebar-link">Docker</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h2> <ul><li>轻量级，配置方便灵活，无侵入性</li> <li>占用内存少，启动快，性能好</li> <li>高并发，事件驱动，异步</li> <li>热部署，修改配置热生效</li></ul> <h2 id="架构模型"><a href="#架构模型" class="header-anchor">#</a> 架构模型</h2> <ul><li>基于 <strong>socket 与 Linux epoll (I/O 事件通知机制)</strong>，实现了 <strong>高并发</strong> <ul><li>使用模块化、事件通知、回调函数、计时器、轮询实现非阻塞的异步模式</li> <li>磁盘不足的情况，可能会导致阻塞</li></ul></li> <li><strong>Master-worker 进程模式</strong> <ul><li>Nginx 启动时会在内存中常驻一个 <strong>Master 主进程</strong>，功能
<ul><li>读取配置文件</li> <li>创建、绑定、关闭 socket</li> <li>启动、维护、配置 worker 进程</li> <li>编译脚本、打开日志</li></ul></li> <li>master 进程会开启配置数量的 <strong>worker 进程</strong>，比如根据 CPU 核数等
<ul><li>利用 socket 监听连接，不会新开进程或线程，节约了创建与销毁进程的成本</li> <li>检查网络、存储，把新连接加入到轮询队列中，异步处理</li> <li>能有效利用 cpu 多核，并避免了线程切换和锁等待</li></ul></li></ul></li> <li><strong>热部署模式</strong> <ul><li>当我们修改配置热重启后，master 进程会以新的配置新创建 worker 进程，新连接会全部交给新进程处理</li> <li>老的 worker 进程会在处理完之前的连接后被 kill 掉，逐步全替换成新配置的 worker 进程</li></ul></li></ul> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <ul><li><p>官网下载</p></li> <li><p>配置文件路径： <code>/usr/local/etc/nginx/nginx.conf</code></p></li> <li><p>启动: 终端输入 <code>nginx</code>，访问 <code>localhost:8080</code> 就能看到 <code>Welcome...</code></p></li> <li><p><code>nginx -s stop</code>: 停止服务</p></li> <li><p><code>nginx -s reload</code>: 热重启服务</p></li> <li><p>配置代理: <code>proxy_pass</code></p> <ul><li>在配置文件中配置即可完成</li></ul> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen 80;
    location / {
        proxy_pass http://xxx.xxx.xx.xx:3000;
    }
}
</code></pre></div></li></ul> <h2 id="常用场景"><a href="#常用场景" class="header-anchor">#</a> 常用场景</h2> <h3 id="代理"><a href="#代理" class="header-anchor">#</a> 代理</h3> <ul><li>其实 Nginx 可以算一层 <strong>代理服务器</strong>，将客户端的请求处理一层后，再转发到业务服务器，这里可以分成两种类型，其实实质就是 <strong>请求的转发</strong>，使用 Nginx 非常合适、高效</li></ul> <h3 id="正向代理"><a href="#正向代理" class="header-anchor">#</a> 正向代理</h3> <ul><li><p>即用户通过访问这层正向代理服务器，再由代理服务器去到原始服务器请求内容后，再返回给用户</p></li> <li><p>例如我们常使用的 VPN 就是一种常见的正向代理模式。通常我们无法直接访问谷歌服务器，但是通过访问一台国外的服务器，再由这台服务器去请求谷歌返回给用户，用户即可访问谷歌</p></li> <li><p><strong>特点</strong></p> <ul><li>代理服务器属于 <strong>客户端层</strong>，称之为正向代理</li> <li>代理服务器是 <strong>为用户服务</strong>，对于用户是透明的，用户知道自己访问代理服务器</li> <li>对内容服务器来说是 <strong>隐藏</strong> 的，内容服务器并无法分清访问是来自用户或者代理</li></ul></li></ul> <h3 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h3> <ul><li><p>用户访问头条的反向代理网关，通过网关的一层处理和调度后，再由网关将访问转发到内部的服务器上，返回内容给用户</p></li> <li><p><strong>特点</strong></p> <ul><li>代理服务器属于 <strong>服务端层</strong>，因此称为反向代理。通常代理服务器与内部内容服务器会隶属于同一内网或者集群</li> <li>代理服务器是 <strong>为内容服务器服务</strong> 的，对用户是隐藏的，用户不清楚自己访问的具体是哪台内部服务器</li> <li>能有效保证内部服务器的 <strong>稳定与安全</strong></li></ul></li> <li><p><strong>反向代理的好处</strong></p> <ul><li>安全与权限
<ul><li>用户访问必须通过反向代理服务器，也就是便可以在做这层做统一的请求校验，过滤拦截不合法、危险的请求，从而就能更好的保证服务器的安全与稳定</li></ul></li> <li>负载均衡: 能有效分配流量，最大化集群的稳定性，保证用户的访问质量</li></ul></li> <li><p><strong>负载均衡</strong></p> <ul><li><p>负载均衡是基于反向代理下实现的一种 <strong>流量分配</strong> 功能，目的是为了达到服务器资源的充分利用，以及更快的访问响应</p></li> <li><p>由于用户并不知道内部服务器中的队列情况，而反向代理服务器是清楚的，因此通过 Nginx，便能很简单地实现流量的均衡分配</p></li> <li><p>Nginx 实现: <code>Upstream</code> 模块， 这样当用户访问 <code>http://xxx</code> 时，流量便会被按照一定的规则分配到 <code>upstream</code> 中的 3 台服务器上</p> <div class="language- extra-class"><pre class="language-text"><code>http {
    upstream xxx {
        server 1.1.1.1:3001;
        server 2.2.2.2:3001;
        server 3.3.3.3:3001;
    }
    server {
        listen 8080;
        location / {
            proxy_pass http://xxx;
        }
    }
}
</code></pre></div></li></ul></li> <li><p><strong>分配策略</strong></p> <ul><li><p><strong>服务器权重( <code>weight</code> )</strong></p> <ul><li><p>可以为每台服务器配置访问权重，传入参数 weight，例如</p> <div class="language- extra-class"><pre class="language-text"><code>upstream xxx {
    server 1.1.1.1:3001 weight=1;
    server 2.2.2.2:3001 weight=1;
    server 3.3.3.3:3001 weight=8;
}
</code></pre></div></li></ul></li> <li><p><strong>时间顺序(默认)</strong>: 按用户的访问的顺序逐一的分配到正常运行的服务器上</p></li> <li><p><strong>连接数优先(<code>least_conn</code>)</strong>: 优先将访问分配到列表中连接数队列最短的服务器上</p></li> <li><p><strong>响应时间优先(<code>fair</code>)</strong>: 优先将访问分配到列表中访问响应时间最短的服务器上</p></li> <li><p><strong>ip_hash</strong>: 通过 ip_hash 指定，使每个 ip 用户都访问固定的服务器上，有利于用户特异性数据的缓存，例如本地 session 服务等</p></li> <li><p><strong>url_hash</strong>: 通过 url_hash 指定，使每个 url 都分配到固定的服务器上，有利于缓存</p></li></ul></li></ul> <h2 id="nginx-对于前端的作用"><a href="#nginx-对于前端的作用" class="header-anchor">#</a> Nginx 对于前端的作用</h2> <ul><li><p><strong>快速配置静态服务器</strong>，当访问 <code>localhost:80</code> 时，就会默认访问到 <code>/Users/files/index.html</code></p> <div class="language- extra-class"><pre class="language-text"><code>server {
  listen 80;
  server_name localhost;

  location / {
    root   /Users/files;
    index  index.html;
  }
}
</code></pre></div></li> <li><p><strong>访问限制</strong>: 可以制定一系列的规则进行访问的控制，例如直接通过 ip 限制</p> <div class="language- extra-class"><pre class="language-text"><code># 屏蔽 192.168.1.1 的访问；
# 允许 192.168.1.2 ~ 10 的访问；
location / {
    deny  192.168.1.1;
    allow 192.168.1.2/10;
    deny  all;
}
</code></pre></div></li> <li><p><strong>解决跨域</strong>: 其实跨域是 <strong>浏览器的安全策略</strong>，这意味着只要不是通过浏览器，就可以绕开跨域的问题。所以只要通过在同域下启动一个 Nginx 服务，转发请求即可</p> <div class="language- extra-class"><pre class="language-text"><code>location ^~/api/ {
  # 重写请求并代理到对应域名下
    rewrite ^/api/(.*)$ /$1 break;
    proxy_pass https://www.cross-target.com/;
}
</code></pre></div></li> <li><p><strong>图片处理</strong>: 通过 ngx_http_image_filter_module 这个模块，可以作为一层图片服务器的代理，在访问的时候 对图片进行特定的操作，例如裁剪，旋转，压缩等</p></li> <li><p><strong>本地代理，绕过白名单限制</strong>: 例如我们在接入一些第三方服务时经常会有一些域名白名单的限制，如果我们在本地通过 <code>localhost</code> 进行开发，便无法完成功能。这里我们可以做一层本地代理，便可以直接通过指定域名访问本地开发环境</p> <div class="language- extra-class"><pre class="language-text"><code>server {
  listen 80;
  server_name www.toutiao.com;

  location / {
      proxy_pass http://localhost:3000;
  }
}
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/11/2021, 3:06:48 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/summary/other/node.html" class="prev">
        Node
      </a></span> <span class="next"><a href="/summary/other/docker.html">
        Docker
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.07d4e7d8.js" defer></script><script src="/assets/js/2.e756895e.js" defer></script><script src="/assets/js/34.021e8dad.js" defer></script>
  </body>
</html>
