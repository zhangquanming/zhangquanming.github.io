<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨标签页通讯 | 全明笔记</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="张全明的个人笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.484694f3.css" as="style"><link rel="preload" href="/assets/js/app.07d4e7d8.js" as="script"><link rel="preload" href="/assets/js/2.e756895e.js" as="script"><link rel="preload" href="/assets/js/30.7f597fdf.js" as="script"><link rel="prefetch" href="/assets/js/10.9dcd3981.js"><link rel="prefetch" href="/assets/js/11.7c3a4891.js"><link rel="prefetch" href="/assets/js/12.9123d821.js"><link rel="prefetch" href="/assets/js/13.dc2b3bbc.js"><link rel="prefetch" href="/assets/js/14.8e9572dd.js"><link rel="prefetch" href="/assets/js/15.0831d9fb.js"><link rel="prefetch" href="/assets/js/16.fff0091e.js"><link rel="prefetch" href="/assets/js/17.13d701e1.js"><link rel="prefetch" href="/assets/js/18.c01d73d7.js"><link rel="prefetch" href="/assets/js/19.6d8da221.js"><link rel="prefetch" href="/assets/js/20.7e3bfbe7.js"><link rel="prefetch" href="/assets/js/21.d67b0029.js"><link rel="prefetch" href="/assets/js/22.a1d1221b.js"><link rel="prefetch" href="/assets/js/23.97f7c972.js"><link rel="prefetch" href="/assets/js/24.f25bbb61.js"><link rel="prefetch" href="/assets/js/25.886c2813.js"><link rel="prefetch" href="/assets/js/26.d354a60e.js"><link rel="prefetch" href="/assets/js/27.8165f251.js"><link rel="prefetch" href="/assets/js/28.38db902f.js"><link rel="prefetch" href="/assets/js/29.d089321c.js"><link rel="prefetch" href="/assets/js/3.c090ecd3.js"><link rel="prefetch" href="/assets/js/31.00125d26.js"><link rel="prefetch" href="/assets/js/32.1b584e55.js"><link rel="prefetch" href="/assets/js/33.b6331f3f.js"><link rel="prefetch" href="/assets/js/34.021e8dad.js"><link rel="prefetch" href="/assets/js/35.2b1e189b.js"><link rel="prefetch" href="/assets/js/36.4643cf1b.js"><link rel="prefetch" href="/assets/js/37.ff936690.js"><link rel="prefetch" href="/assets/js/4.55092137.js"><link rel="prefetch" href="/assets/js/5.02018b5a.js"><link rel="prefetch" href="/assets/js/6.bd7b0c2a.js"><link rel="prefetch" href="/assets/js/7.711e75c5.js"><link rel="prefetch" href="/assets/js/8.35b709e8.js"><link rel="prefetch" href="/assets/js/9.029996af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.484694f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">全明笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/summary/" class="nav-link router-link-active">
  知识总结
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  工具类
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  学习资料
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="https://www.mingme.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zhangquanming/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/summary/" class="nav-link router-link-active">
  知识总结
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  工具类
</a></div><div class="nav-item"><a href="/links/" class="nav-link">
  学习资料
</a></div><div class="nav-item"><a href="/code/" class="nav-link">
  手写代码
</a></div><div class="nav-item"><a href="https://www.mingme.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zhangquanming/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>知识总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/" aria-current="page" class="sidebar-link">前言</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/css/base.html" class="sidebar-link">CSS基础知识</a></li><li><a href="/summary/css/layout.html" class="sidebar-link">常见布局方式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript 相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/javascript/" class="sidebar-link">JavaScript基础知识</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>浏览器与网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/http/web.html" aria-current="page" class="active sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/summary/http/web.html#跨标签页通讯" class="sidebar-link">跨标签页通讯</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#浏览器架构" class="sidebar-link">浏览器架构</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#事件循环-event-loop" class="sidebar-link">事件循环(Event Loop)</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#从输入-url-到展示的过程" class="sidebar-link">从输入 url 到展示的过程</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#重绘与回流" class="sidebar-link">重绘与回流</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#存储" class="sidebar-link">存储</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#web-worker" class="sidebar-link">Web Worker</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#v8-垃圾回收机制" class="sidebar-link">V8 垃圾回收机制</a></li><li class="sidebar-sub-header"><a href="/summary/http/web.html#内存泄露" class="sidebar-link">内存泄露</a></li></ul></li><li><a href="/summary/http/service.html" class="sidebar-link">服务端与网络</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/framework/vue.html" class="sidebar-link">Vue</a></li><li><a href="/summary/framework/react.html" class="sidebar-link">React</a></li><li><a href="/summary/framework/Hybrid.html" class="sidebar-link">Hybrid</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>构建工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/bundler/webpack.html" class="sidebar-link">Webpack</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/monitor/monitor.html" class="sidebar-link">前端监控</a></li><li><a href="/summary/performance/performance.html" class="sidebar-link">项目性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>全栈基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/summary/other/node.html" class="sidebar-link">Node</a></li><li><a href="/summary/other/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/summary/other/docker.html" class="sidebar-link">Docker</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="跨标签页通讯"><a href="#跨标签页通讯" class="header-anchor">#</a> 跨标签页通讯</h2> <p>不同标签页间的通讯，本质原理就是去运用一些可以 <strong>共享的中间介质</strong>，因此比较常用的有以下方法:</p> <ul><li><p>通过父页面 <code>window.open()</code> 和子页面 <code>postMessage</code></p> <ul><li>异步下，通过 <code>window.open('about: blank')</code> 和 <code>tab.location.href = '*'</code></li></ul></li> <li><p>设置同域下共享的 <code>localStorage</code> 与监听 <code>window.onstorage</code></p> <ul><li>重复写入相同的值无法触发</li> <li>会受到浏览器隐身模式等的限制</li></ul></li> <li><p>设置共享 <code>cookie</code> 与不断轮询脏检查( <code>setInterval</code> )</p></li> <li><p>借助服务端或者中间层实现</p></li></ul> <h2 id="浏览器架构"><a href="#浏览器架构" class="header-anchor">#</a> 浏览器架构</h2> <ul><li>用户界面</li> <li>Browser 进程</li> <li>第三方插件进程 （每种类型的插件对应一个进程，当使用该插件时才创建）</li> <li>GPU 进程 （该进程也只有一个，用于 3D 绘制等等）</li> <li>内核（渲染进程 Renderer）
<ul><li>GUI 渲染线程</li> <li>JS 引擎线程
<ul><li>执行栈</li></ul></li> <li>事件触发线程
<ul><li>消息队列
<ul><li>微任务</li> <li>宏任务</li></ul></li></ul></li> <li>异步 HTTP 线程</li> <li>定时器线程</li></ul></li></ul> <h2 id="事件循环-event-loop"><a href="#事件循环-event-loop" class="header-anchor">#</a> 事件循环(Event Loop)</h2> <p>事件循环是指: JS 引擎线程只会执行执行栈中的事件，执行栈中的代码执行完毕，就会读取事件队列中的事件并添加到执行栈中继续执行，这样反反复复就是我们所谓的事件循环(Event Loop)</p> <ul><li>宏任务 <code>macrotask(task)</code>:
<ul><li>主代码块</li> <li>setTimeout</li> <li>setInterval</li> <li>setImmediate - Node</li> <li>requestAnimationFrame - 浏览器</li></ul></li> <li>微任务 <code>microtask(jobs)</code>:
<ul><li>process.nextTick () - Node</li> <li>Promise.then()</li> <li>catch</li> <li>finally</li> <li>Object.observe</li> <li>MutationObserver</li></ul></li></ul> <h2 id="从输入-url-到展示的过程"><a href="#从输入-url-到展示的过程" class="header-anchor">#</a> 从输入 url 到展示的过程</h2> <ul><li>查找缓存</li> <li>DNS 解析</li> <li>TCP 三次握手</li> <li>发送请求，分析 url，设置请求报文(头，主体)</li> <li>服务器返回请求的文件 (html)</li> <li>关闭 TCP 连接：通过四次挥手释放 TCP 连接</li> <li>浏览器渲染
<ul><li>HTML parser --&gt; DOM Tree
<ul><li>标记化算法，进行元素状态的标记</li> <li>dom 树构建</li></ul></li> <li>CSS parser --&gt; Style Tree
<ul><li>解析 css 代码，生成样式树</li></ul></li> <li>attachment --&gt; Render Tree
<ul><li>结合 dom 树 与 style 树，生成渲染树</li></ul></li> <li>layout: 布局</li> <li>GPU painting: 像素绘制页面</li></ul></li></ul> <h2 id="重绘与回流"><a href="#重绘与回流" class="header-anchor">#</a> 重绘与回流</h2> <p>当元素的样式发生变化时，浏览器需要触发更新，重新绘制元素。这个过程中，有两种类型的操作，即重绘与回流。</p> <ul><li><strong>重绘(repaint)</strong>: 当元素样式的改变不影响布局时，浏览器将使用重绘对元素进行更新，此时由于只需要 UI 层面的重新像素绘制，因此 <strong>损耗较少</strong></li> <li><strong>回流(reflow)</strong>: 当元素的尺寸、结构或触发某些属性时，浏览器会重新渲染页面，称为回流。此时，浏览器需要重新经过计算，计算后还需要重新页面布局，因此是较重的操作。会触发回流的操作:
<ul><li>页面初次渲染</li> <li>浏览器窗口大小改变</li> <li>元素尺寸、位置、内容发生改变</li> <li>元素字体大小变化</li> <li>添加或者删除可见的 dom 元素</li> <li>激活 CSS 伪类（例如：:hover）</li> <li>查询某些属性或调用某些方法
<ul><li>clientWidth、clientHeight、clientTop、clientLeft</li> <li>offsetWidth、offsetHeight、offsetTop、offsetLeft</li> <li>scrollWidth、scrollHeight、scrollTop、scrollLeft</li> <li>getComputedStyle()</li> <li>getBoundingClientRect()</li> <li>scrollTo()</li></ul></li></ul></li></ul> <p>回流必定触发重绘，重绘不一定触发回流。重绘的开销较小，回流的代价较高。</p> <h2 id="存储"><a href="#存储" class="header-anchor">#</a> 存储</h2> <p>我们经常需要对业务中的一些数据进行存储，通常可以分为 短暂性存储 和 持久性储存。</p> <ul><li>短暂性的时候，我们只需要将数据存在内存中，只在运行时可用</li> <li>持久性存储，可以分为 浏览器端 与 服务器端
<ul><li>浏览器:
<ul><li><code>cookie</code>: 通常用于存储用户身份，登录状态等
<ul><li><code>http</code> 中自动携带， 体积上限为 4K， 可自行设置过期时间</li></ul></li> <li><code>localStorage / sessionStorage</code>: 长久储存/窗口关闭删除， 体积限制为 4~5M</li> <li><code>indexDB</code></li></ul></li> <li>服务器:
<ul><li>分布式缓存 redis</li> <li>数据库</li></ul></li></ul></li></ul> <h2 id="web-worker"><a href="#web-worker" class="header-anchor">#</a> Web Worker</h2> <p>现代浏览器为 <code>JavaScript</code> 创造的 <strong>多线程环境</strong>。可以新建并将部分任务分配到 <code>worker</code> 线程并行运行，两个线程可 <strong>独立运行，互不干扰</strong>，可通过自带的 <strong>消息机制</strong> 相互通信。</p> <h4 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法:</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建 worker</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'work.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 向 worker 线程推送消息</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>

<span class="token comment">// 监听 worker 线程发送过来的消息</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received message '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="限制"><a href="#限制" class="header-anchor">#</a> 限制:</h4> <ul><li>同源限制</li> <li>无法使用 <code>document</code> / <code>window</code> / <code>alert</code> / <code>confirm</code></li> <li>无法加载本地资源</li></ul> <h2 id="v8-垃圾回收机制"><a href="#v8-垃圾回收机制" class="header-anchor">#</a> V8 垃圾回收机制</h2> <p>V8 的垃圾回收策略主要基于 <strong>分代式垃圾回收机制</strong>，根据根据<strong>对象的存活时间</strong>将内存的垃圾回收进行不同的分代，然后根据不同的分代采用不同的垃圾回收算法，其主要分成 <strong>新生代空间</strong> 和 <strong>老生代空间</strong>。</p> <ul><li><strong>新生代空间</strong>: 用于存活较短的对象
<ul><li>又分成两个空间: from 空间 与 to 空间</li> <li>Scavenge GC 算法: 当 from 空间被占满时，启动 GC 算法
<ul><li>存活的对象从 from space 转移到 to space</li> <li>清空 from space</li> <li>from space 与 to space 互换</li> <li>完成一次新生代 GC</li></ul></li></ul></li> <li><strong>老生代空间</strong>: 用于存活时间较长的对象
<ul><li>从 新生代空间 转移到 老生代空间 的条件
<ul><li>经历过一次以上 Scavenge GC 的对象</li> <li>当 to space 体积超过 25%</li></ul></li> <li><strong>标记清除</strong>: 标记存活的对象，未被标记的则被释放</li> <li><strong>标记整理</strong>: 将内存中清除后导致的碎片化对象往内存堆的一端移动，解决 <strong>内存的碎片化</strong></li> <li><strong>增量标记与惰性清理</strong></li> <li><strong>并发回收</strong></li></ul></li></ul> <h2 id="内存泄露"><a href="#内存泄露" class="header-anchor">#</a> 内存泄露</h2> <ul><li>意外的<strong>全局变量</strong>: 无法被回收</li> <li><strong>定时器</strong>: 未被正确关闭，导致所引用的外部变量无法被释放</li> <li><strong>事件监听</strong>: 没有正确销毁 (低版本浏览器可能出现)</li> <li><strong>闭包</strong>: 会导致父级中的变量无法被释放</li> <li><strong>dom 引用</strong>: dom 元素被删除时，内存中的引用未被正确清空</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/8/2023, 10:16:55 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/summary/javascript/" class="prev">
        JavaScript基础知识
      </a></span> <span class="next"><a href="/summary/http/service.html">
        服务端与网络
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.07d4e7d8.js" defer></script><script src="/assets/js/2.e756895e.js" defer></script><script src="/assets/js/30.7f597fdf.js" defer></script>
  </body>
</html>
